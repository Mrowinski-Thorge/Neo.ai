<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Neo AI Labs</title>
    <script>
        var lang = navigator.language || navigator.userLanguage; 
        if (lang.startsWith('en')) {
             window.location.replace("en/");
        } else {
             window.location.replace("de/");
        }
    </script>
</head>
<body>
<!--
Old content below
-->
<div style="display:none">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeoAI • Private Local AI</title>
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- Ambient Background Effects -->
    <div class="ambient ambient-glow ambient-glow--blue"></div>
    <div class="ambient ambient-glow ambient-glow--purple"></div>

    <!-- ============================================
         SCREEN 1: ONBOARDING
         Erste Ansicht für neue Benutzer
         ============================================ -->
    <section id="onboarding" class="screen active">
        <div class="container text-center">
            <!-- Logo/Icon -->
            <div class="icon-box animate-float">
                <i data-lucide="sparkles"></i>
            </div>

            <!-- Headline -->
            <h1 class="animate-fade-in">NeoAI</h1>
            <p class="animate-fade-in animate-delay-1" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted);">
                Powered by Qwen 2.5
            </p>
            
            <div class="spacer-lg"></div>

            <!-- Description -->
            <p class="animate-fade-in animate-delay-2" style="max-width: 380px; margin: 0 auto;">
                Echte KI, die vollständig auf deinem Gerät läuft. 
                Keine Cloud. Keine Kosten. Deine Daten bleiben privat.
            </p>

            <div class="spacer-xl"></div>

            <!-- Feature Cards -->
            <div class="features animate-fade-in animate-delay-3">
                <div class="feature-card">
                    <i data-lucide="wifi-off"></i>
                    <h4>100% Offline</h4>
                    <p>Funktioniert ohne Internet</p>
                </div>
                <div class="feature-card">
                    <i data-lucide="shield-check"></i>
                    <h4>Privat</h4>
                    <p>Keine Datenübertragung</p>
                </div>
                <div class="feature-card">
                    <i data-lucide="cpu"></i>
                    <h4>WebGPU</h4>
                    <p>Hardware-beschleunigt</p>
                </div>
                <div class="feature-card">
                    <i data-lucide="database"></i>
                    <h4>Lokal</h4>
                    <p>Gespeichert im Browser</p>
                </div>
            </div>

            <div class="spacer-2xl"></div>

            <!-- CTA Button -->
            <button id="onboarding-continue" class="btn btn--primary">
                Weiter
                <i data-lucide="arrow-right"></i>
            </button>

            <div class="spacer-md"></div>
            <p class="text-muted" style="font-size: 0.75rem;">
                Im nächsten Schritt wird das KI-Modell geladen (~1GB)
            </p>
        </div>
    </section>

    <!-- ============================================
         SCREEN 2: MODEL LOADER
         Download & Initialisierung des Modells
         ============================================ -->
    <section id="model-loader" class="screen">
        <div class="container text-center">
            <!-- Icon -->
            <div class="icon-box">
                <i data-lucide="download-cloud"></i>
            </div>

            <h2>Modell wird vorbereitet</h2>
            
            <div class="spacer-sm"></div>
            
            <p style="max-width: 320px; margin: 0 auto;">
                Dies geschieht nur einmal. Das Modell wird lokal gespeichert.
            </p>

            <div class="spacer-xl"></div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-header">
                    <span id="progress-status">Initialisiere...</span>
                    <span id="progress-percent" class="progress-percent">0%</span>
                </div>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <p id="progress-detail" class="progress-detail">Verbindung wird hergestellt...</p>
            </div>

            <div class="spacer-2xl"></div>

            <!-- Cancel Button -->
            <button id="cancel-load" class="btn btn--secondary">
                Abbrechen
            </button>
        </div>
    </section>

    <!-- ============================================
         SCREEN 3: HOME (Chat Interface)
         Hauptbildschirm nach dem Laden
         ============================================ -->
    <section id="home" class="screen chat-screen">
        <!-- Chat Header -->
        <header class="chat-header">
            <div class="chat-header__left">
                <h1 class="chat-header__title">NeoAI</h1>
                <span class="chat-header__status" id="model-status">
                    <span class="status-dot"></span>
                    Bereit
                </span>
            </div>
            <button id="open-settings" class="btn btn--icon btn--secondary" aria-label="Einstellungen">
                <i data-lucide="settings"></i>
            </button>
        </header>

        <!-- Chat Messages Area -->
        <main class="chat-messages" id="chat-messages">
            <!-- Welcome State (shown when no messages) -->
            <div class="chat-welcome" id="chat-welcome">
                <div class="icon-box icon-box--small">
                    <i data-lucide="sparkles"></i>
                </div>
                <h2>Hallo!</h2>
                <p>Ich bin NeoAI, dein privater KI-Assistent. Stelle mir eine Frage.</p>
            </div>
            <!-- Messages will be inserted here -->
        </main>

        <!-- Chat Input Area -->
        <footer class="chat-input-area">
            <form id="chat-form" class="chat-form">
                <div class="chat-input-wrapper">
                    <textarea 
                        id="chat-input" 
                        class="chat-input" 
                        placeholder="Nachricht eingeben..." 
                        rows="1"
                        autocomplete="off"
                    ></textarea>
                    <button type="submit" id="send-btn" class="btn btn--send" disabled aria-label="Senden">
                        <i data-lucide="arrow-up"></i>
                    </button>
                </div>
            </form>
            <p class="chat-disclaimer">NeoAI läuft lokal auf deinem Gerät. Keine Daten werden übertragen.</p>
        </footer>
    </section>

    <!-- ============================================
         SETTINGS DIALOG
         Modal für Einstellungen
         ============================================ -->
    <dialog id="settings-dialog" class="glass" style="
        position: fixed;
        max-width: 400px;
        width: calc(100% - 2rem);
        padding: 0;
        border: 1px solid var(--bg-glass-border);
        border-radius: var(--radius-xl);
        color: var(--text-primary);
    ">
        <div style="padding: var(--space-lg); border-bottom: 1px solid var(--bg-glass-border); display: flex; justify-content: space-between; align-items: center;">
            <h3 style="font-size: 1rem;">Einstellungen</h3>
            <button id="close-settings" class="btn btn--icon btn--secondary">
                <i data-lucide="x" style="width: 18px; height: 18px;"></i>
            </button>
        </div>
        
        <div style="padding: var(--space-lg);">
            <p class="text-muted" style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-md);">
                Daten & Speicher
            </p>
            
            <!-- Clear Chats -->
            <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-md); background: rgba(255,255,255,0.03); border-radius: var(--radius-md); margin-bottom: var(--space-sm);">
                <div>
                    <p style="font-size: 0.875rem; font-weight: 500;">Chat Verlauf</p>
                    <p style="font-size: 0.75rem; color: var(--text-muted);">Alle Nachrichten löschen</p>
                </div>
                <button id="btn-clear-chats" class="btn btn--icon btn--secondary" style="color: #ef4444;">
                    <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
                </button>
            </div>

            <!-- Clear Model Cache -->
            <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-md); background: rgba(255,255,255,0.03); border-radius: var(--radius-md);">
                <div>
                    <p style="font-size: 0.875rem; font-weight: 500;">Modell Cache</p>
                    <p style="font-size: 0.75rem; color: var(--text-muted);">~1GB Speicher freigeben</p>
                </div>
                <button id="btn-clear-cache" class="btn btn--icon btn--secondary" style="color: #ef4444;">
                    <i data-lucide="database" style="width: 16px; height: 16px;"></i>
                </button>
            </div>

            <div class="spacer-lg"></div>
            
            <p class="text-muted text-center" style="font-size: 0.625rem;">
                NeoAI v2.0 • Qwen2.5-0.5B • WebGPU
            </p>
        </div>
    </dialog>

    <!-- JavaScript -->
    <script src="js/app.js"></script>

    <!-- Initialize Icons after DOM load -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // Settings Dialog Logic
            const settingsDialog = document.getElementById('settings-dialog');
            const openSettingsBtn = document.getElementById('open-settings');
            const closeSettingsBtn = document.getElementById('close-settings');
            const resetAppBtn = document.getElementById('reset-app');
            const clearChatsBtn = document.getElementById('btn-clear-chats');
            const clearCacheBtn = document.getElementById('btn-clear-cache');

            if (openSettingsBtn) {
                openSettingsBtn.addEventListener('click', () => settingsDialog.showModal());
            }
            if (closeSettingsBtn) {
                closeSettingsBtn.addEventListener('click', () => settingsDialog.close());
            }
            if (resetAppBtn) {
                resetAppBtn.addEventListener('click', () => {
                    if (confirm('App zurücksetzen? Du siehst wieder das Onboarding.')) {
                        NeoAI.resetOnboarding();
                    }
                });
            }
            if (clearChatsBtn) {
                clearChatsBtn.addEventListener('click', () => {
                    if (confirm('Alle Chats löschen?')) {
                        NeoAI.clearAllChats();
                        alert('Chats gelöscht.');
                    }
                });
            }
            if (clearCacheBtn) {
                clearCacheBtn.addEventListener('click', async () => {
                    if (confirm('Modell-Cache löschen? Das Modell muss erneut geladen werden.')) {
                        await NeoAI.clearModelCache();
                        location.reload();
                    }
                });
            }

            // Close dialog on backdrop click
            settingsDialog.addEventListener('click', (e) => {
                if (e.target === settingsDialog) {
                    settingsDialog.close();
                }
            });
        });
    </script>
</div>
</body>
</html>
